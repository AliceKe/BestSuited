<!doctype html>
<title>{% block title %}{% endblock %} - BestSuited</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap"
    rel="stylesheet">

<body>
    <div class="full-body-container">
        <div class="top-text">
            <!-- <div class="google-colors">
                <h1 id="google-4">4</h1>
                <h1 id="google-3">3</h1>
                <h1 id="google-0-1">0</h1>
                <h1 id="google-0-2">0</h1>
            </div> -->
            <div class="header">
                <img src="../static/images/logo.png" alt="header">
            </div>
            <div class="input-box" onclick="sendFocus()">
                <img src="{{ url_for('static', filename='images/mag.png') }}" />
                <input placeholder="Search for a job title, company or skills" id="filter-text-val"
                    onkeyup="filterText()">
            </div>
        </div>
        <div class="filter-opt">
            <label for="filter-opts">Sort by</label>
            <select id="filter-opts">
                <option value="">Select</option>
                <option value="rating">Company Rating</option>
                <option value="workhappiness">Work Happiness Score</option>
                <option value="learning">Learning Happiness Score</option>
                <option value="appreciation">Appreciation Score</option>
                <option value="purpose">Purpose Score</option>
                <option value="flexibility">Flexibility Score</option>
                <option value="achievement">Achievement Score</option>
                <option value="inclusion">Inclusion Score</option>
                <option value="support">Support Score</option>
                <option value="energy">Energy Score</option>
                <option value="trust">Trust Score</option>
                <option value="compensation">Compensation Score</option>
                <option value="belonging">Belonging Score</option>
                <option value="management">Management Score</option>
            </select>
            <button id="sort-direction-btn">&#9650;</button>
        </div>
        <div id="answer-box">

        </div>
    </div>

    <script>

        function jobPostingDiv(posting) {
            console.log(posting)
            return `<div class=''>
                <h3 class='episode-title'>${posting.role}</h3>
                <p class='episode-desc'>Location: ${posting.city}</p>
            </div>`
        }

        function sendFocus() {
            document.getElementById('filter-text-val').focus()
        }

        function filterText() {
            document.getElementById("answer-box").innerHTML = ""
            const sortingParam = document.getElementById("filter-opts").value;
            // console.log(document.getElementById("filter-opt-ratings").value)
            // console.log(document.getElementById("filter-text-val").value)
            let urlSearchParams = { title: document.getElementById("filter-text-val").value, sortingDir: sortingDirection }
            if (sortingParam !== "") {
                urlSearchParams.filter_opts = sortingParam;
            }
            fetch("/episodes?" + new URLSearchParams(urlSearchParams).toString())
                .then((response) => response.json())
                .then((data) => {
                    const companies = data.map(([companyName, companyData]) => {
                        return {
                            name: companyName,
                            data: companyData
                        };
                    });

                    companies.forEach((company) => {
                        let tempDiv = document.createElement("div")
                        let tmpContent = `<h2> ${company.name}</h2>`
                        console.log(company.data.postings)
                        company.data.postings.forEach((p) => {
                            console.log(p)

                            tempDiv.innerHTML = ""

                            tmpContent += jobPostingDiv(p)
                        })
                        tempDiv.innerHTML = tmpContent
                        document.getElementById("answer-box").appendChild(tempDiv)
                    })

                })
        }

        let sortingDirection = "asc";
        document.getElementById("sort-direction-btn").addEventListener("click", function () {
            sortingDirection = sortingDirection === "asc" ? "desc" : "asc";
            document.getElementById("sort-direction-btn").innerHTML = sortingDirection === "asc" ? "&#9650;" : "&#9660;";
            filterText();
        });
        document.getElementById("filter-opts").addEventListener("change", function () {
            filterText()
        });


    </script>
</body>